<html>
    <head>
        <title>Up N Down</title>
    </head>
    <body style="background-color:#000; font-family: segoe ui, arial;">
        
        <table style="margin: 100px auto; padding: 50px; background-color: rgb(237, 237, 237);">
            <tr>
                <td id="items">
                    <!-- put items here -->
                    <div style="background-color:#eee; border: 1px #ccc solid; width:200px; height: 320px; float: left;"></div>
                    <div style="background-color:#eee; border: 1px #ccc solid; width:200px; height: 320px; float: left;"></div>
                    <div style="background-color:#eee; border: 1px #ccc solid; width:200px; height: 320px; float: left;"></div>
                    <div style="background-color:#eee; border: 1px #ccc solid; width:200px; height: 320px; float: left;"></div>
                    <div style="background-color:#eee; border: 1px #ccc solid; width:200px; height: 320px; float: left;"></div>
                    <div style="background-color:#eee; border: 1px #ccc solid; width:200px; height: 320px; float: left;"></div>
                    <div style="clear: both;"></div>
                </td>
                <td rowspan="2" style="padding: 25px;">
                    <!-- QR code + group ID -->
                    <div id="qr"></div>
                    <div>
                        <h1>Scan the QR code or visit</h1>
                        <h4 id="joinUrl"></h4>
                    </div>
                </td>
            </tr>
            <tr>
                <td id="people">
                    <h2>Please join and get the party started!</h2>
                </td>
            </tr>
        </table>
        
        <!-- JS -->
        <script src="jquery.min.js" type="text/javascript"></script>
        <script src="jquery.cookie.js"></script>
        <script src="qrcode.min.js" type="text/javascript"></script>
        <script src="http://js.pusher.com/2.1/pusher.min.js" type="text/javascript"></script>
        <script type="text/javascript">

            $(document).ready(function() {

                var vanityId = $.cookie("vanity");
                var getGroup = "http://100.64.9.47:3000/parties/";
                var joinGroupUrl = "http://100.64.9.47:3000/join/";

                if (vanityId == undefined) {
                    $.ajax({
                        type: "POST",
                        url: getGroup,
                        async: false,
                        success: function(data) {
                            vanityId = data.vanity.toString();
                            $.cookie("vanity", vanityId);
                            $.cookie('vanity', vanityId, { expires: 7, path: '/' });
                        }
                    });
                }

                new QRCode(document.getElementById("qr"), "http://upndown.com/parties/" + vanityId);
                $("#joinUrl").html(joinGroupUrl + vanityId);

                $.ajax({
                    type: "GET",
                    url: getGroup + vanityId,
                    async: false,
                    success: function (data) {
                        if (data.movies != null) {
                            $("#items").empty();
                            $.each(data.movies, function(key, value) {
                                $("#items").append($("div").html(value.toString()));
                            });
                        }
                        if (data.users != null) {
                            
                        }
                    }
                });

                var pusher = new Pusher('46ca20df50350d13e678');
                var channel = pusher.subscribe("x" + vanityId);
                channel.bind('event', function(data) {
                    alert(data.message);
                });

            });
        </script>

    </body>
</html>