<html>
    <head>
        <title>Up N Down</title>
        <style type="text/css">
            .item {
                background-color: #eee;
                border: 1px #ccc solid;
                width: 120px;
                height: 180px;
                margin-right: 20px;
                margin-bottom: 20px;
                float: left
            }
            .user {
                background-color: #eee;
                border: 1px #ccc solid;
                width: 50px;
                height: 50px;
                margin-right: 10px;
                float: left;
            }
        </style>
    </head>
    <body style="background-color:#000; font-family: segoe ui, arial;">
        
        <table style="margin: 100px auto; padding: 50px; background-color: rgb(237, 237, 237);">
            <tr>
                <td>
                    <!-- put items here -->
                    <div id="items"></div>
                    <div style="clear: both;"></div>
                </td>
                <td rowspan="2" style="padding: 25px;">
                    <!-- QR code + group ID -->
                    <div id="qr"></div>
                    <div>
                        <h1>Scan the QR code or visit</h1>
                        <h4 id="joinUrl"></h4>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="users">
                        <h4>Please join and get the party started!</h4>
                    </div>
                    <div style="clear: both;"></div>
                </td>
            </tr>
        </table>
        
        <!-- JS -->
        <script src="jquery.min.js" type="text/javascript"></script>
        <script src="jquery.cookie.js"></script>
        <script src="qrcode.min.js" type="text/javascript"></script>
        <script src="http://js.pusher.com/2.1/pusher.min.js" type="text/javascript"></script>
        <script type="text/javascript">

            var vanityId;
            var serviceUri;
            var getGroup;

            function updateView() {

                $.ajax({
                    type: "GET",
                    url: getGroup + vanityId,
                    async: false,
                    success: function (data) {
                        if (data.movies != null) {
                            $("#items").empty();
                            $.each(data.movies, function (key, value) {
                                $("#items").append($("div").addClass("item").html(value.toString()));
                            });
                        }
                        if (data.users != null) {
                            $("#users").empty();
                            $.each(data.movies, function (key, value) {
                                $("#users").append($("div").addClass("user").html(value.toString()));
                            });
                        }
                    }
                });

                setTimeout(updateView, 5000);
            }

            $(document).ready(function () {

                vanityId = $.cookie("vanity");
                serviceUri = "http://10.45.40.119:3000/";
                getGroup = serviceUri + "parties/";
                var joinGroupUrl = serviceUri + "parties/";
                var joinUrl = serviceUri + "parties/" + vanityId;

                if (vanityId == undefined) {
                    $.ajax({
                        type: "POST",
                        url: getGroup,
                        async: false,
                        success: function(data) {
                            vanityId = data.vanity.toString();
                            $.cookie("vanity", vanityId);
                            $.cookie('vanity', vanityId, { expires: 7, path: '/' });
                        }
                    });
                }

                new QRCode(document.getElementById("qr"), joinUrl);
                $("#joinUrl").html(joinGroupUrl + vanityId);

                setTimeout(updateView, 5000);
            });
        </script>

    </body>
</html>